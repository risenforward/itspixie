import Code from 'components/Markdown/Code'

export const meta = {
  title: 'Latest Beta',
  position: 100
}

## Overview

### Prisma CLI

You can get access to the latest beta release of the Prisma CLI by appending the `@beta`-tag when installing it via NPM:

```
npm install -g prisma@beta
```

### Prisma server (Docker)

You can find the latest beta Prisma Docker image on [Docker Hub](https://hub.docker.com/r/prismagraphql/prisma/tags/). To use the latest version of a Prisma server, you need to configure the `image` property in your Docker Compose file accordingly by appending `-beta` to the the version number, e.g.:

<Code lines="4">

```yml
version: '3'
services:
  prisma:
    image: prismagraphql/prisma:1.21-beta
    restart: always
    ports:
    - "4466:4466"
    environment:
      PRISMA_CONFIG: |
        managementApiSecret: __YOUR_MANAGEMENT_API_SECRET__
        port: __YOUR_PRISMA_SERVER_PORT__
        databases:
          default:
            connector: __YOUR_DATABASE_CONNECTOR__
            migrations: __ENABLE_DB_MIGRATIONS__
            host: __YOUR_DATABASE_HOST__
            port: __YOUR_DATABASE_PORT__
            user: __YOUR_DATABASE_USER__
            password: __YOUR_DATABASE_PASSWORD__
```

</Code>

You can also pull the latest beta version directly using the Docker CLI:

```bash
docker pull prismagraphql/prisma:1.21-beta
```

## 1.21-beta: Mongo DB

With the `1.21-beta`-release, Prisma introduces a database connector for [MongoDB](https://www.mongodb.com/).

In Mongo, the `@id` field is required!

### Concepts

MongoDB is a [document database](https://en.wikipedia.org/wiki/Document-oriented_database) which stands in contrast to [relational databases](https://en.wikipedia.org/wiki/Relational_database). 

![](https://imgur.com/vItK7n8.png)
*Source: [MongoDB Documentation](https://www.mongodb.com/blog/post/thinking-documents-part-1)*

#### Tables vs Collections

Relational databases store their data in **tables** that are defined within the database _schema_. Data is [normalized](https://en.wikipedia.org/wiki/Database_normalization) (_flattened_) and relations between tables are implemented using _keys_ as references between data records. A table contains a number of **rows** which represent _instances_ of the table.

MongoDB doesn't have the concept of tables. It is a _schemaless_ database that stores its data in **[collections](https://docs.mongodb.com/manual/reference/glossary/#term-collection)**. A collection contains a number of **[documents](https://docs.mongodb.com/manual/reference/glossary/#term-document)**. A document is the most basic unit of data in MongoDB and stored in [BSON](http://bsonspec.org/).

> **Note**: While MongoDB is a schemaless database, using it with Prisma does effectively impose a schema on it.

#### Relations

One of the biggest differences between document and relational databases is the way how _relations_ between data types are handled. 

While relational databases use [database normalization](https://en.wikipedia.org/wiki/Database_normalization) to store flat data records that reference each other via keys, document databases are able to store an object physically co-located to a related object in the same collection. The latter is called _embedding_ data (i.e. a document can have _embedded_ sub-documents/arrays).

With MongoDB, relations can be expressed either by _embedding_ data directly in a parent document or by using _references_. A good overview on the differences can be found in the MongoDB [documentation](https://www.mongodb.com/blog/post/thinking-documents-part-2#modeling-relationships-with-embedding-and-referencing). Prisma adops the idea of _embedded_ types when modeling data for MongoDB.

### Data modeling

#### Embedded types

The MongoDB connector introduces the concept of _embedded types_. An embedded type ...

- is always annotated with the `@embedded` directive.
- always has one _parent type_.
- is always stored directly _within_ its _parent type's_ [collection](https://docs.mongodb.com/manual/reference/glossary/#term-collection) in the underlying Mongo database (i.e. it does not have its own collection).
- can not have an ID (i.e. a field annotated with the `@id` directive).
- can not have unique fields (i.e. fields annotated with the `@unique` directive).
- can not have have a (back-)relation to its parent type (but it can have relations to other non-embedded types).
- can not be queried directly using the Prisma API but only via _nested operations_ through the parent type. 
- can not be created, updated or deleted directly using the Prisma API but only via _nested operations_ through the parent type. 

Here is an example of a datamodel where `Coordinates` is defined as an embedded type:

```graphql
type City {
  id: ID! @id
  name: String!
  coordinates: Coordinates
}

type Coordinates @embedded {
  latitude: Float!
  longitude: Float!
}
```

With this setup, it is _not_ possible to query any instances of `Coordinates` directly because `Coordinates` is an embedded type. `Coordinates` can only be queried via the `City` type. Similarly, you can not create, update or delete coordinates directly, instead you need to create, update or delete a `City` in order to perform such operation on an instance of `Coordinates`. 

> You can learn more about embedded types in the [specification](https://github.com/prisma/prisma/issues/2836).

#### Links & Relations

With MongoDB, you can model relations in two ways:

- Using an [embedded type](#embedded-types) as explained above

A relation with the Mongo connector works in the way that:

- One side of the relation stores the ID of the object on the other side
- The other side of the relation has no reference to the other object

You can denote the side of the relation that should store the ID using the `strategy` parameter of the `@relation` directive. In the following example, the `User` type stores the ID values of all the `Post` objects it's related to. A `Post` object however doesn't store any information about its `author` in the underlying Mongo database:

```graphql
type User {
  id: ID! @id
  name: String!
  posts: [Post!]! @relation(strategy: EMBED)
}

type Post {
  id: ID! @id
  title: String!
  author: User!
}
```

Consequently, operations that go from a `Post` to a `User` via the `author` field will be more expensive. This is because the underlying `Post` objects don't know who their `author`s are and Prisma needs to filter all `User`s to find who the `author` of `Post` is.


### Get Started

#### 1. Setup

Install the latest version of the Prisma CLI using the instructions [above](#prisma-cli). Then run the following command to initialize a new Prisma service:

```
prisma init hello-mongo
```

This launches the interactive wizard that helps you configure Prisma. To test the Mongo connector, you need to select the following answers for the first two questions:

- **Create new database**
- **MongoDB**

As a last step in the wizard, you need to select your preferred language for the Prisma client.

The Prisma CLI now created a `hello-mongo` directory for you which contains your project setup. The Docker Compose file is used to launch a Prisma server that's backed by a MongoDB. Navigate into the project directory and run the following command to start the Prisma server:

```
docker-compose up -d
```

> Note: This might throw an error if you already have Prisma Docker containers running locally. In that case, you can [reset your Docker containers](rty1-hard-resetting-the-docker-environment).

You can verify that the Docker containers for Prisma and for your MongoDB have been started correctly by running `docker ps`. This should print something similar to this:

```
$ docker ps
CONTAINER ID        IMAGE                             COMMAND                  CREATED              STATUS              PORTS                      NAMES
5f3d8cc20699        mongo:3.6                         "docker-entrypoint.s…"   About a minute ago   Up About a minute   0.0.0.0:27017->27017/tcp   hello-mongo_mongo_1
fc261a149740        prismagraphql/prisma:1.21-beta    "/bin/sh -c /app/sta…"   About a minute ago   Up About a minute   0.0.0.0:4466->4466/tcp     hello-mongo_prisma_1
```

#### 2. Configuring the datamodel

The MongoDB connector uses a slight variation of datamodel syntax compated to the existing database connectors.

### The `@id` directive

